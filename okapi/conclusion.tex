In this work, we introduced, Okapi, a semi-supervised method for training distributionally-robust
models that is intuitive, effective, and is applicable to any modality or task.
%
Okapi is based on the simple idea of supplementing the supervised loss with a cross-domain
consistency loss that encourages the outputs of an encoder network to be similar for neighbouring
(within the latent space of the encoder itself) samples  belonging to different domains, which is
made efficient using an online-learning framework.
%
Rather than simply using $k$-NN with a cross-domain constraint, however, we propose an augmented
form based on statistical matching (\CNN) that combines propensity scores with calipers to winnow
out low-quality matches; we find this to be important for both the end-performance and consistency
of Okapi.
%
Our work serves as a response to \cite{SagWeiLeeGaoetal22}, in that we find that it is in fact
possible to effectively incorporate unlabelled data and domain information into a training
algorithm in order to improve upon ERM with respect to an OOD test set, assuming an appropriate
choice of architecture.
%
Namely, on three datasets from the WILDS 2.0 benchmark, representing two different tasks
(classification and regression) and modalities (image and text), we show that Okapi outperforms
both the ERM and FixMatch baselines according to the relevant OOD metrics.
%

Buoyed by these promising results, we intend to apply Okapi to other tasks (e.g. object detection
and image segmentation) and other modalities (e.g. audio) to further establish its generality.
%
Furthermore, one limitation of the current incarnation of the method is that the thresholds for the
calipers are fixed over the course of training whereas it may be beneficial to set these adaptively
with the view to optimise such measures of inter-domain balance as \emph{Variance Ratio} and
\emph{Standard Mean Differences} that are commonly used to evaluate the the goodness of statistical
matching procedures.

\section*{Acknowledgements}
This research was supported by a European Research Council (ERC) Starting Grant for the project
"Bayesian Models and Algorithms for Fairness and Transparency", funded under the European Union's
Horizon 2020 Framework Programme (grant agreement no. 851538). NQ is also supported by the Basque
Government through the BERC 2018-2021 program and by Spanish Ministry of Sciences, Innovation and
Universities: BCAM Severo Ochoa accreditation SEV-2017-0718.
